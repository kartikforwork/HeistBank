<%layout('layout')%>
<style>
    body {
       background: linear-gradient(to right, 	#9e0217, black);
       margin: 0;
       padding: 0;
       font-family: Arial, sans-serif;
       height: 100vh;
     }
 </style>
    <div class="d-flex flex-column justify-content-center align-items-center flex-grow-1">
        <div class="card text-bg-dark" style="width: 35rem;">
            <div class="card-header">
                <div class="mb-3">
                <h1 class="card-title">Transferring Money</h1>
            </div>
            <div class="mb-3">
                <h3 class="card-text">Form Account: <%= oneCustomerData.name %></h3>
            </div>
            <div class="mb-3">
                <p class="card-text">Ammount Available: â‚¹<%= oneCustomerData.amountAvailable %></p>
            </div>
            </div>
            <ul class="card-body">
                <form class="pay-form">
                    <li class="list-group-item">
                        <div class="mb-3">
                            <label for="customer" class="form-label">Recipient Account Holder Name:</label>
                            <select style="width:90%;" class="form-control" id="customer" name="customer">
                                <option value="" disabled selected>Select an option</option>
                                <% for (const data of otherCustomerData) { %>
                                    <option value="<%= data.id %>">
                                        <%= data.name %>
                                    </option>
                                    <% } %>
                            </select>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount to Transfer:</label>
                            <input style="width:90%;" type="number" class="form-control" id="amount" name="amount">
                        </div>
                    </li>
                    <li class="list-group-item"><button id="stop" type="submit" class="btn btn-primary">Send</button></li>
                </form>
            </ul>
        </div>
    </div>


<!--Inside index.html -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>

$(document).ready(function(){
	$('.pay-form').submit(function(e){
		e.preventDefault();

		var formData = $(this).serialize();
		$.ajax({
			url:"/createOrder",
			type:"POST",
			data: formData,
			success:function(res){
				if(res.success){
					var options = {
						"key": ""+res.key_id+"",
						"amount": ""+res.amount+"",
						"currency": "INR",
						"name": "<%= oneCustomerData.name %>",
						"description": ""+res.description+"",
						"image": "<%= oneCustomerData.img %>",
						"order_id": ""+res.order_id+"",
                        "handler": function (response){
                            // Payment Succeeded
                            $.ajax({
                                url: "/heistbank/customers/<%=oneCustomerData.id%>",
                                type: "POST",
                                data: formData,
                                success: function(){
                                    window.open("/heistbank/customers","_self");
                                },
                                error: function(){
                                    alert("There was an error processing your transaction.");
                                }
                            });
                        },
						"prefill": {
							"contact":""+res.contact+"",
							"name": ""+res.name+"",
							"email": ""+res.email+""
						},
						"notes" : {
							"description":""+res.description+""
						},
						"theme": {
							"color": "#9e0217"
						}
					};
					var razorpayObject = new Razorpay(options);
					razorpayObject.on('payment.failed', function (response){
							alert("Payment Failed");
					});
					razorpayObject.open();
				}
				else{
					alert(res.msg);
				}
			}
		})

	});
});

</script>
